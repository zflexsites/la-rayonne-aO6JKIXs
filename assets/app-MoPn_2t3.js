const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/verify-P5e-wCt9.js","assets/_commonjsHelpers-Cpj98o6Y.js"])))=>i.map(i=>d[i]);
const Qe="modulepreload",Ye=function(e){return"/"+e},Ee={},B=function(t,n,o){let r=Promise.resolve();if(n&&n.length>0){let p=function(m){return Promise.all(m.map(y=>Promise.resolve(y).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),d=l?.nonce||l?.getAttribute("nonce");r=p(n.map(m=>{if(m=Ye(m),m in Ee)return;Ee[m]=!0;const y=m.endsWith(".css"),h=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${h}`))return;const v=document.createElement("link");if(v.rel=y?"stylesheet":Qe,y||(v.as="script"),v.crossOrigin="",v.href=m,d&&v.setAttribute("nonce",d),document.head.appendChild(v),y)return new Promise((i,s)=>{v.addEventListener("load",i),v.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${m}`)))})}))}function a(l){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=l,window.dispatchEvent(d),!d.defaultPrevented)throw l}return r.then(l=>{for(const d of l||[])d.status==="rejected"&&a(d.reason);return t().catch(a)})};function Xe(){const e=document.getElementById("zflex-data");if(!e||!e.textContent)return console.warn("[Core/API] Tunnel de data #zflex-data est vide ou introuvable."),{};try{return JSON.parse(e.textContent)}catch(t){return console.error("[Core/API] Erreur de parsing du tunnel de data #zflex-data:",t),{}}}async function x(e,t){const o=Xe().apiEndpoints?.[e];if(!o)throw new Error(`Endpoint API pour "${e}" non trouv√©. V√©rifiez la configuration du builder.`);try{const r=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await r.json();if(!r.ok){const l=a.error||`Erreur ${r.status}`;throw new Error(l)}return a}catch(r){throw console.error(`[API] Erreur pour "${e}":`,r),new Error("La communication avec nos services a √©chou√©. Veuillez r√©essayer.")}}function Pe(e,t={}){return x("createConv",{storeId:e,context:t})}function Ze(e,t,n,o){return x("stacy",{storeId:e,convId:t,message:n,contextDelta:o})}function Se(e,t,n){return x("continueConv",{storeId:e,convId:t,functionCallResult:n})}function an(e,t){return x("createOrder",{...e,storeId:t})}function sn(e,t){return x("getOrderDetails",{orderId:e,storeId:t})}function cn(e,t,n,o,r){return x("initiatePayment",{orderId:e,storeId:t,paymentMethod:n,paymentPhone:o,transactionReference:r})}function ln(e,t){return x("getOrderStatusApi",{orderId:e,storeId:t})}function dn(e,t){return x("getProspectInfo",{storeId:e,prospectId:t})}function et(e,t){return x("subscribeToNewsletter",{email:e,storeId:t})}function tt(e,t){return x("trackEvent",{storeId:e,events:t})}let J=null;async function $e(){if(J)return J;try{const e=await fetch("/api/search-index.json");if(!e.ok)throw new Error(`Erreur r√©seau: ${e.statusText}`);return J=await e.json(),J||[]}catch(e){return console.error("[Core/API] Impossible de charger l'index des produits:",e),[]}}const F=window.zflexEventBus||new EventTarget;window.zflexEventBus=F;const Oe="zflex_cart";function $(){const e=localStorage.getItem(Oe);return e?JSON.parse(e):[]}function te(e){localStorage.setItem(Oe,JSON.stringify(e)),window.dispatchEvent(new CustomEvent("cartUpdated"))}function pe(e,t=1){const n=$(),o=n.find(r=>r.id===e.id);o?o.quantity+=t:n.push({...e,quantity:t}),te(n)}function Me(e,t){let n=$();const o=n.find(r=>r.id===e);o&&(t>0?o.quantity=t:n=n.filter(r=>r.id!==e),te(n))}function ge(e){const t=$().filter(n=>n.id!==e);te(t)}function nt(){te([])}function Ce(){const e=document.getElementById("cart-count");if(!e)return;const n=$().reduce((o,r)=>o+r.quantity,0);e.textContent=String(n),e.style.display=n>0?"flex":"none",n>0&&(e.classList.add("updated"),setTimeout(()=>{e.classList.remove("updated")},300))}function qe(){if(!document.querySelector('[data-page-type="cart"]'))return;const t=document.getElementById("cart-items-list"),n=document.getElementById("cart-subtotal"),o=document.getElementById("cart-total"),r=document.getElementById("cart-empty-state"),a=document.getElementById("cart-content");if(!t||!n||!o||!r||!a){console.error("[Cart] Erreur critique: DOM manquant dans cart.njk.");return}const l=$(),d=document.getElementById("cart-item-template");if(!d){console.error("[Cart] Erreur critique: le template #cart-item-template est manquant.");return}if(l.length===0){r.classList.remove("hidden"),a.classList.add("hidden");return}r.classList.add("hidden"),a.classList.remove("hidden"),t.innerHTML="";let p={};l.forEach(m=>{const y=Number(m.price?.amount||0),h=m.price?.currency||"EUR",v=Number(m.quantity||1),i=d.content.cloneNode(!0),s=i.querySelector('[data-template-field="image"]');s&&(s.src=m.coverImage||"");const f=i.querySelector('[data-template-field="title"]');f&&(f.textContent=m.title||"Produit sans nom");const c=i.querySelector('[data-template-field="url"]');c&&(c.href=m.url||"#");const u=i.querySelector('[data-template-field="price"]');u&&(u.textContent=`${y.toFixed(2)} ${h}`);const g=i.querySelector('[data-template-field="quantity"]');g&&(g.value=String(v),g.addEventListener("change",()=>Me(m.id,parseInt(g.value,10))));const w=i.querySelector('[data-template-field="total"]');w&&(w.textContent=`${(y*v).toFixed(2)} ${h}`);const E=i.querySelector('[data-template-field="remove-btn"]');E&&E.addEventListener("click",()=>ge(m.id)),t.appendChild(i),p[h]||(p[h]=0),p[h]+=y*v}),n.innerHTML="",o.innerHTML="",Object.entries(p).forEach(([m,y])=>{const h=`${Number(y).toFixed(2)} ${m}`;n.innerHTML+=`<div>${h}</div>`,o.innerHTML+=`<div>${h}</div>`})}function ot(){document.querySelector('[data-page-type="cart"]')&&(console.log("[Cart] Initialisation de la page panier..."),qe())}async function rt(){document.querySelectorAll("#add-to-cart-btn").forEach(t=>{const n=t;n.dataset.listenerAttached||(n.addEventListener("click",async()=>{n.disabled=!0;try{const o=document.getElementById("zflex-data");if(!o)throw new Error("Erreur critique: Tunnel de data #zflex-data manquant.");const r=JSON.parse(o.textContent||"{}");if(!r?.product)throw new Error("Donn√©es du produit non trouv√©es dans le tunnel de data.");const l=(await $e()).find(d=>d.id===r.product.id);if(l)pe(l),F.dispatchEvent(new CustomEvent("dialog:show",{detail:{title:"Ajout√© au panier !",message:`${l.title.trim()} a bien √©t√© ajout√©.`,variant:"success"}}));else throw new Error("Produit introuvable dans l'index de recherche.")}catch(o){console.error("Erreur lors de l'ajout au panier:",o),F.dispatchEvent(new CustomEvent("dialog:show",{detail:{title:"Erreur",message:o.message||"Impossible d'ajouter ce produit au panier.",variant:"error"}}))}finally{n.disabled=!1}}),n.dataset.listenerAttached="true")})}function at(){Ce(),window.addEventListener("cartUpdated",()=>{Ce(),qe()}),console.log("[Cart] Module global initialis√©.")}const st=Object.freeze(Object.defineProperty({__proto__:null,addItem:pe,clearCart:nt,getCart:$,initAddToCartButton:rt,initCartPage:ot,initGlobalCart:at,removeItem:ge,updateItemQuantity:Me},Symbol.toStringTag,{value:"Module"})),De="zflex_analytics_queue_v1",it=1e4,ct=50,lt=3,dt=150;let S=[],ae=!1,se=null,xe=0;function Be(){try{const e=document.getElementById("zflex-data");return!e||!e.textContent?{}:JSON.parse(e.textContent)}catch{return{}}}function ut(){try{const e=localStorage.getItem(De);e&&(S=JSON.parse(e))}catch(e){console.warn("[Analytics] Load queue failed.",e),S=[]}}function ye(){try{localStorage.setItem(De,JSON.stringify(S))}catch(e){console.warn("[Analytics] Persist queue failed.",e)}}function ft(e,t={}){const n=Be()||{},o=document.querySelector("main");return{type:e,payload:t,storeId:n.storeId||null,context:{pageType:o?.dataset.pageType||null,title:document.title,url:window.location.href},ts:new Date().toISOString(),version:n.zflex_version||null}}function T(e,t={}){if(!e)return;const n=ft(e,t);S.push(n),ye(),console.log(`[Analytics] Event Queued: ${e}`,t)}async function Ne(e,t=1){if(!e||e.length===0)return{ok:!0};try{const n=e[0].storeId;return n?(await tt(n,e),{ok:!0}):{ok:!1,error:"Missing storeId"}}catch(n){return t<lt?(await new Promise(o=>setTimeout(o,1e3*t)),Ne(e,t+1)):{ok:!1,error:String(n)}}}async function ce(){if(!(ae||S.length===0)){ae=!0;try{const e=S.slice(0,ct),t=await Ne(e);t&&t.ok&&(S.splice(0,e.length),ye())}finally{ae=!1}}}function mt(){se&&clearInterval(se),se=setInterval(ce,it),document.addEventListener("visibilitychange",()=>document.visibilityState==="hidden"&&ce()),window.addEventListener("beforeunload",()=>{if(S.length!==0)try{const e=Be(),t=e.apiEndpoints?.trackEvent;navigator.sendBeacon&&t&&(navigator.sendBeacon(t,JSON.stringify({storeId:e.storeId,events:S})),S=[],ye())}catch(e){console.warn("[Analytics] Beacon failed.",e)}})}function pt(){const e={"stacy:message_sent":t=>T("send_stacy_message",{length:t.message.length}),"cart:item_added":t=>T("add_to_cart",t.item),"cart:item_removed":t=>T("remove_from_cart",t.item),"cart:cleared":()=>T("clear_cart"),"checkout:purchase_success":t=>T("purchase",t.order)};for(const[t,n]of Object.entries(e))F.addEventListener(t,o=>n(o.detail))}function gt(e){const t=e.getAttribute("data-analytics-type")||"",n=e.getAttribute("data-analytics-payload");let o={};if(n)try{o=JSON.parse(n)}catch(r){console.warn("[Analytics] √âchec parsing payload, attribut brut:",{payloadAttr:n,error:r})}return{type:t,payload:o}}function yt(){document.addEventListener("click",e=>{const t=Date.now();if(t-xe<dt){e.stopImmediatePropagation();return}xe=t;const o=e.target.closest("[data-analytics-type]");if(!o)return;const{type:r,payload:a}=gt(o);r&&T(r,a)},!0)}function ht(){ut(),mt(),yt(),pt(),console.log("[Analytics] Module V3.2 (The Final Cut) initialis√©.")}function ne({path:e,title:t,extra:n={}}={}){T("pageview",{url:e||window.location.href,title:t||document.title,...n})}function He(e,t={}){T(e,t)}window.zflexAnalytics={track:He,trackPageview:ne,flush:ce,getQueue:()=>S};const vt=Object.freeze(Object.defineProperty({__proto__:null,initAnalytics:ht,track:He,trackPageview:ne},Symbol.toStringTag,{value:"Module"}));let le=!1;function ze(){Re(),window.addEventListener("popstate",()=>he());try{ne()}catch(e){console.warn("[Router] Le tracking de la page initiale a √©chou√©:",e)}console.log("[Router] Initialis√© en mode GATEKEEPER.")}function de(e){if(le)return;const n=e.target.closest("a.zflex-link");if(!n||n.target==="_blank")return;const o=new URL(n.href);if(o.hash&&o.pathname===window.location.pathname){e.preventDefault();const a=document.querySelector(o.hash);a&&a.scrollIntoView({behavior:"smooth",block:"start"});return}if(o.origin!==window.location.origin)return;e.preventDefault(),e.preventDefault();const r=o.pathname+o.search+o.hash;je(r)}function Re(){document.body.addEventListener("touchstart",()=>{le=!1},{passive:!0}),document.body.addEventListener("touchmove",()=>{le=!0},{passive:!0}),document.body.addEventListener("click",de),document.body.addEventListener("touchend",de)}function je(e){e!==window.location.pathname&&(history.pushState({},"",e),he())}async function he(){const e=window.location.pathname;console.log(`[Router] Navigation d√©tect√©e vers : ${e}`);const t=e==="/"||e===""?"/content/home.html":`/content${e.replace(/\/$/,"")}.html`,n=document.getElementById("app-content"),o=document.getElementById("router-loader");if(!n){console.error("ERREUR CRITIQUE: Conteneur #app-content introuvable.");return}o&&o.classList.remove("hidden"),n.style.opacity="0.5",n.style.transition="opacity 0.3s ease-in-out";try{const r=await fetch(t);if(!r.ok){if(r.status===404){const d=await(await fetch("/content/404.html")).text();ue(d,"404 - Page non trouv√©e");return}throw new Error(`Erreur serveur: ${r.statusText}`)}const a=await r.text();ue(a)}catch(r){const a=r instanceof Error?r.message:String(r);console.error("Erreur de routage critique:",r),n.innerHTML=`
      <div class="text-center py-20">
        <h1 class="text-2xl font-bold">Erreur de chargement</h1>
        <p class="text-gray-600 mt-2">${a}</p>
        <button onclick="window.location.reload()" class="mt-4 bg-primary text-white font-bold py-2 px-4 rounded">Recharger la page</button>
      </div>
    `}finally{if(o&&o.classList.add("hidden"),document.body.contains(n)&&(n.style.opacity="1"),window.location.hash){const r=window.location.hash;setTimeout(()=>{const a=document.querySelector(r);a&&a.scrollIntoView({behavior:"smooth",block:"start"})},100)}else window.scrollTo(0,0)}}function ue(e,t=null){const n=document.getElementById("app-content"),o=document.getElementById("zflex-data"),l=new DOMParser().parseFromString(e,"text/html").querySelector("main");if(l&&o&&n){const d=l.querySelector(".zflex-fragment-data");d&&(o.textContent=d.textContent,d.remove()),document.title=t||l.dataset.pageTitle||document.title,n.innerHTML="",n.appendChild(l),window.dispatchEvent(new CustomEvent("zflex:page-loaded",{detail:{path:window.location.pathname}}));try{ne()}catch(p){console.warn("[Router] Le tracking de la nouvelle page a √©chou√©:",p)}}else console.error("Erreur critique: <main> ou #zflex-data manquant.")}const wt=Object.freeze(Object.defineProperty({__proto__:null,bindEventListeners:Re,handleLinkClick:de,handleLocationChange:he,initRouter:ze,navigateTo:je,updatePageContent:ue},Symbol.toStringTag,{value:"Module"}));let C=!1,_=[],fe=null,W=null;const Fe=1440*60*1e3,D=e=>`stacy_conv_${e}`,oe=e=>`stacy_history_${e}`,bt=new Set(["searchProducts","manageCart","getContextDelta","redirectToVerifyPage"]);function U(){try{const t=document.getElementById("zflex-data")?.textContent;return t?JSON.parse(t):{}}catch(e){return console.error("[Stacy] Erreur de parsing des donn√©es de la page",e),{}}}async function Ue(){if(W)return W;try{const e=await fetch("/api/search-index.json");if(!e.ok)throw new Error(`R√©ponse r√©seau non OK: ${e.statusText}`);return W=await e.json(),W||[]}catch(e){return console.error("[Stacy] Impossible de charger l'index de recherche:",e),[]}}function I(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Et(e){try{const t=String(e).trim();if(/^(https?:|mailto:)/i.test(t))return t}catch{}return"#"}function ve(e){let t=I(e);return t=t.replace(/```([\s\S]*?)```/g,(n,o)=>`<pre class="stacy-code"><code>${I(o)}</code></pre>`),t=t.replace(/`([^`]+)`/g,(n,o)=>`<code class="stacy-inline-code">${I(o)}</code>`),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(n,o,r)=>`<a href="${Et(r)}" target="_blank" rel="noopener noreferrer" class="zflex-link">${I(o)}</a>`),t=t.replace(/\*\*([^*]+)\*\*/g,(n,o)=>`<strong>${I(o)}</strong>`),t=t.replace(/\*([^*]+)\*/g,(n,o)=>`<em>${I(o)}</em>`),t=t.replace(/\r?\n/g,"<br>"),t}function we(e){try{let t=function(l){const d=Array.from(l.childNodes);for(const p of d)if(p.nodeType===Node.ELEMENT_NODE){const m=p;if(a.has(m.tagName)){if(m.tagName==="A"){const y=m.getAttribute("href")||"";/^(https?:|mailto:)/i.test(y.trim())?(m.setAttribute("target","_blank"),m.setAttribute("rel","noopener noreferrer")):m.removeAttribute("href")}else{const y=Array.from(m.attributes);for(const h of y)m.removeAttribute(h.name)}t(m)}else{const y=document.createDocumentFragment();for(;m.firstChild;)y.appendChild(m.firstChild);l.replaceChild(y,m),t(l);continue}}else p.nodeType!==Node.TEXT_NODE&&l.removeChild(p)};const r=new DOMParser().parseFromString(`<div>${e}</div>`,"text/html").body.firstChild;if(!r)return"";const a=new Set(["A","UL","OL","LI","STRONG","EM","CODE","PRE","BR","P"]);return t(r),r.innerHTML}catch(t){return console.warn("[Stacy] sanitizeHtml failed, falling back to escaped text",t),I(e)}}function re(e,t,n={rawHtml:!1}){const o=document.querySelector("[data-stacy-messages]");if(!o)return;const r=document.createElement("div");r.className="flex flex-col p-1 my-1 max-w-[85%] text-sm break-words";const a=document.createElement("div");a.className="p-2 rounded-lg";const l=document.createElement("div");l.className="text-xs mb-1 truncate";const d=typeof e.text=="string"?e.text:JSON.stringify(e.text??"");t==="user"?(r.style.alignSelf="flex-end",a.classList.add("bg-primary/20","self-end"),l.textContent="Vous",l.style.textAlign="right",a.textContent=d):(r.style.alignSelf="flex-start",l.textContent="Stacy",l.style.color="var(--text-muted-color)",a.classList.add("self-start"),a.style.backgroundColor="var(--chat-response-bg-color)",a.style.color="var(--text-color)",n.rawHtml?a.innerHTML=we(d):a.innerHTML=ve(d)),r.appendChild(l),r.appendChild(a),o.appendChild(r),o.scrollTop=o.scrollHeight}function Ve(){const e=document.querySelector("[data-stacy-messages]");e&&(e.innerHTML="",_.forEach(t=>re(t,t.role,{rawHtml:!0})))}async function St(){const e=U().storeId;if(!e)return;const t=localStorage.getItem(D(e)),n=t?JSON.parse(t):null;if(n&&Date.now()-n.createdAt<Fe){const o=localStorage.getItem(oe(n.convId));_=o?JSON.parse(o):[],Ve()}else await We(e)}function q(e){localStorage.setItem(oe(e),JSON.stringify(_))}function G(e,t){const n={role:t,text:e,ts:Date.now()};_.push(n),re(n,t,{rawHtml:!0})}function Ct(){const e=document.querySelector("[data-stacy-messages]");if(!e)return null;const t=document.createElement("div");return t.className="p-2 my-1 rounded-lg max-w-[60%] self-start text-sm break-words stacy-typing",t.innerHTML='<div class="typing-indicator"><span></span><span></span><span></span></div>',e.appendChild(t),e.scrollTop=e.scrollHeight,t}function xt(e,t={rawHtml:!1}){const n=document.querySelector("[data-stacy-messages]");if(!n)return null;const o=document.createElement("div");o.className="flex flex-col p-1 my-1 max-w-[85%] text-sm break-words model-message-wrapper";const r=document.createElement("div");r.className="text-xs mb-1 truncate",r.textContent="Stacy",r.style.color="var(--muted-text-color)";const a=document.createElement("div");a.className="p-2 rounded-lg self-start model-message-bubble";const l=e;t.rawHtml?a.innerHTML=we(l):a.innerHTML=ve(l);const d=document.createElement("div");return d.className="stacy-partial-loader",d.style.marginTop="6px",d.innerHTML='<div class="typing-indicator"><span></span><span></span><span></span></div>',d.style.display="none",o.appendChild(r),o.appendChild(a),o.appendChild(d),n.appendChild(o),n.scrollTop=n.scrollHeight,{wrapper:o,bubble:a,loader:d}}function Ie(e){!e||!e.loader||(e.loader.style.display="",e.wrapper.scrollIntoView({behavior:"smooth",block:"end"}))}function M(e){!e||!e.loader||(e.loader.style.display="none")}function k(e,t,n={rawHtml:!1}){!e||!e.bubble||(n.rawHtml?e.bubble.innerHTML=we(t):e.bubble.innerHTML=ve(t),M(e))}async function Le(e,t=12e3){let n;return Promise.race([e,new Promise((o,r)=>n=setTimeout(()=>r(new Error("timeout")),t))]).finally(()=>clearTimeout(n))}async function Je(e){const t=D(e);try{const n=localStorage.getItem(t);if(n){const r=JSON.parse(n);if(Date.now()-(r.createdAt||0)<=Fe)return r.convId}const o=await Pe(e);if(!o?.convId)throw new Error("createConversation n'a pas retourn√© de convId");return localStorage.setItem(t,JSON.stringify({convId:o.convId,createdAt:Date.now()})),localStorage.removeItem(oe(o.convId)),o.convId}catch(n){throw console.error("[Stacy] Erreur getOrCreateConvId",n),n}}async function We(e){try{const t=localStorage.getItem(D(e)),n=t?JSON.parse(t):null;n&&localStorage.removeItem(oe(n.convId)),localStorage.removeItem(D(e)),_=[],Ve();const o=await Pe(e);if(o?.convId){localStorage.setItem(D(e),JSON.stringify({convId:o.convId,createdAt:Date.now()}));const r=o.greeting||"Salut ! C'est Stacy, ton assistante shopping. Pr√™t(e) √† trouver des p√©pites ? ‚ú®";G(r,"model"),q(o.convId)}}catch(t){console.error("[Stacy] resetConversation error",t),re({text:"Impossible de r√©initialiser la conversation."},"model")}}async function It(e){e.preventDefault();const n=e.target.querySelector("[data-stacy-input]");if(!n)return;const o=n.value.trim();if(!o)return;G(o,"user"),n.value="";const r=U().storeId;if(r){const a=await Je(r);q(a)}await Lt(o)}async function Lt(e){const t=document.querySelector("[data-stacy-input]");t&&(t.disabled=!0);const n=Ct();try{const o=U().storeId;if(!o)throw new Error("storeId introuvable");const r=await Je(o),a=await Ze(o,r,e);if(n&&n.remove(),a.newConvId&&localStorage.setItem(D(o),JSON.stringify({convId:a.newConvId,createdAt:Date.now()})),a.functionCall){const p=xt("Un instant, je r√©fl√©chis... ü§î",{rawHtml:!1});if(Ie(p),a.needsUserInput){M(p);const y=a.answer||"J'ai besoin d'une information suppl√©mentaire.";if(k(p,y,{rawHtml:!1}),p&&p.wrapper){const h=p.wrapper,v=document.createElement("input");v.type="text",v.placeholder="Entrez le num√©ro de commande...",v.className="stacy-inline-input";const i=document.createElement("button");i.textContent="Envoyer",i.className="stacy-inline-btn";const s=document.createElement("div");s.style.marginTop="8px",s.appendChild(v),s.appendChild(i),h.appendChild(s),v.focus();const f=async()=>{const c=v.value.trim();if(c){s.remove(),Ie(p);try{const u=a.functionCall?.name||"unknown",w=(await Se(o,r,{name:u,result:{orderId:c}}))?.answer??"D√©sol√©, erreur lors de la finalisation.";k(p,w,{rawHtml:!0}),_.push({role:"model",text:w}),q(r)}catch{M(p),k(p,"Erreur lors de l'envoi de l'information. R√©essaie.",{rawHtml:!1})}}};i.addEventListener("click",f),v.addEventListener("keydown",c=>{c.key==="Enter"&&f()})}return}const m=a.functionCall.name||"unknown";if(bt.has(m))try{const y=await Le(Tt(a.functionCall),12e3),h=y.result??y,i=(await Le(Se(o,r,{name:m,result:h}),2e4))?.answer??"D√©sol√©, erreur lors de la finalisation.";i.includes("__tool_result")?p?.wrapper.remove():(k(p,i,{rawHtml:!0}),_.push({role:"model",text:i})),q(r);return}catch{M(p),k(p,"Impossible d'ex√©cuter l'action c√¥t√© client.",{rawHtml:!1});return}if(a.answer){M(p),k(p,a.answer,{rawHtml:!0}),_.push({role:"model",text:a.answer}),q(r);return}M(p),k(p,"Action en attente...",{rawHtml:!1});return}const l=a?.answer??"D√©sol√©, une erreur est survenue.";G(l,"model"),q(r)}catch(o){n&&n.remove(),console.error("[Stacy] Erreur processStacyRequest",o),G("Oups, quelque chose s'est mal pass√©. Veuillez r√©essayer.","model")}finally{t&&(t.disabled=!1,C&&t.focus())}}async function Tt(e){const t=e.name||e.functionName||e.fn||"unknown",n=e.args||e.arguments||e.params||{};switch(t){case"searchProducts":{const o=String(n.keywords||n.q||""),r=await _t(o);return{success:!!r.success,action:"searchProducts",result:r}}case"manageCart":{const o=await kt(n);return{success:!!o.success,action:"manageCart",result:o}}case"redirectToVerifyPage":{const o=await Pt();return{success:!!o.success,action:"redirectToVerifyPage",result:o}}case"getContextDelta":return{success:!0,action:"getContextDelta",result:At()};default:return console.warn(`[Stacy] functionCall non g√©r√© c√¥t√© client: ${t}`),{success:!1,action:String(t),result:{displayText:`Action demand√©e inconnue c√¥t√© client: ${String(t)}`,reason:"unknown"}}}}async function _t(e){const t=await Ue(),n=String(e||"").toLowerCase().split(" ").filter(r=>r),o=t.filter(r=>n.every(a=>r.title.toLowerCase().includes(a)));return o.length>0?{success:!0,products:o.slice(0,3).map(a=>({id:a.id,title:a.title,price:a.price,shortDescription:a.shortDescription,url:a.url})),displayText:`J'ai trouv√© ${o.length} produit(s).`}:{success:!1,displayText:`D√©sol√©, je n'ai trouv√© aucun produit pour "${I(String(e))}".`}}async function kt(e){const t=e.action,n=e.productId,o=e.quantity||1;switch(t){case"add":{if(!n)return{success:!1,displayText:"Je ne sais pas quel produit ajouter."};const a=(await Ue()).find(l=>l.id===n);return a?(pe(a,o),{success:!0,displayText:`J'ai ajout√© ${o}x "${a.title}" √† votre panier.`}):{success:!1,displayText:`Je n'ai pas trouv√© le produit avec l'ID ${n}.`}}case"remove":return n?(ge(n),{success:!0,displayText:"L'article a √©t√© retir√© de votre panier."}):{success:!1,displayText:"Je ne sais pas quel produit retirer."};case"list":default:{const r=$();return!r||r.length===0?{success:!0,cart:[],displayText:"Votre panier est actuellement vide."}:{success:!0,cart:r,displayText:`Votre panier contient ${r.length} article(s).`}}}}function At(){return{pageType:document.querySelector("#app-content main")?.dataset.pageType||"unknown",pageTitle:document.title,url:window.location.href,productContext:U().product||null}}async function Pt(){if(fe)try{return fe.navigateTo("/verify/"),me(),{success:!0,displayText:"[Action Syst√®me] Redirection vers /verify/ effectu√©e."}}catch(e){return console.warn("[Stacy] Router navigation failed",e),{success:!1,displayText:"[Action Syst√®me] Routeur non disponible."}}else return{success:!1,displayText:"[Action Syst√®me] Routeur non disponible."}}function me(){const e=document.querySelector("[data-stacy-window]"),t=document.querySelector("[data-stacy-fab-button]");if(!e||!t)return;C=!C,e.classList.toggle("is-open",C),e.classList.toggle("hidden",!C),t.setAttribute("aria-expanded",String(C));const n=t.querySelector('[data-stacy-icon="chat"]'),o=t.querySelector('[data-stacy-icon="close"]');if(n&&o&&(n.style.opacity=C?"0":"1",o.style.opacity=C?"1":"0"),C){St();const r=document.querySelector("[data-stacy-input]");r&&setTimeout(()=>r.focus(),50)}}function $t(){const e=document.querySelector("[data-stacy-fab-button]");e&&e.addEventListener("click",me);const t=document.querySelector("[data-stacy-form]");if(t){t.addEventListener("submit",It);const o=t.querySelector("[data-stacy-input]");o&&o.addEventListener("keydown",r=>{const a=r;a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),t.requestSubmit())})}document.addEventListener("keydown",o=>{o.key==="Escape"&&C&&me()});const n=document.querySelector("[data-stacy-delete]");n&&n.addEventListener("click",async()=>{try{const o=U().storeId;if(!o)throw new Error("storeId introuvable");await We(o)}catch(o){console.error("[Stacy] delete conv failed",o),re({text:"Impossible de supprimer la conversation."},"model")}})}function Ot(e){document.querySelector("[data-stacy-fab]")&&(fe=e,$t(),console.log("[Stacy] Module V7.5 (Brain Upgrade) initialis√©."))}const Mt=Object.freeze(Object.defineProperty({__proto__:null,initStacy:Ot},Symbol.toStringTag,{value:"Module"}));let H;function qt(){const e=document.getElementById("install-app-btn");e&&(console.log("[PWA] L'application est maintenant installable."),e.disabled=!1,e.classList.remove("opacity-50","cursor-not-allowed"),e.addEventListener("click",Dt,{once:!0}))}function Ke(){const e=document.getElementById("install-app-btn"),t=document.getElementById("app-installed-message");e&&t&&(e.classList.add("hidden"),t.classList.remove("hidden"))}async function Dt(){if(!H)return;H.prompt();const{outcome:e}=await H.userChoice;e==="accepted"?(console.log("[PWA] L'utilisateur a accept√© l'installation."),Ke()):console.log("[PWA] L'utilisateur a refus√© l'installation."),H=null}function Bt(){window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone?(console.log("[PWA] D√©tect√© comme une application install√©e."),Ke()):window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),H=e,qt()}),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(()=>console.log("[PWA] Service Worker OK.")).catch(e=>console.error("[PWA] Service Worker KO:",e))}const Nt=Object.freeze(Object.defineProperty({__proto__:null,initPwa:Bt},Symbol.toStringTag,{value:"Module"}));let P=null,ie=null,Q=null,z=null,R=null,A=null,Y=null,X=null,Z=null,ee=null,j=null;function be(){P&&(P.classList.add("hidden"),ee=null,j=null)}function Ht(){if(typeof ee=="function")try{ee()}catch(e){console.error("[Dialog] Erreur dans onConfirm:",e)}be()}function zt(){if(typeof j=="function")try{j&&j()}catch(e){console.error("[Dialog] Erreur dans onCancel:",e)}be()}function L(e,t,n={}){if(!P){alert(`${e}

${t}`),n.onConfirm&&n.onConfirm();return}Y?.classList.add("hidden"),X?.classList.add("hidden"),Z?.classList.add("hidden"),n.variant==="success"?Y?.classList.remove("hidden"):n.variant==="error"?X?.classList.remove("hidden"):Z?.classList.remove("hidden"),Q&&(Q.textContent=e),z&&(n.messageHtml?z.innerHTML=n.messageHtml:z.textContent=t||""),R&&(R.textContent=n.confirmText||"OK"),A&&(n.cancelText?(A.classList.remove("hidden"),A.textContent=n.cancelText):A.classList.add("hidden")),ee=typeof n.onConfirm=="function"?n.onConfirm:null,j=typeof n.onCancel=="function"?n.onCancel:null,P.classList.remove("hidden")}function Rt(){if(P=document.getElementById("zflex-dialog"),!!P){if(ie=document.getElementById("dialog-overlay"),Q=document.getElementById("dialog-title"),z=document.getElementById("dialog-message"),R=document.getElementById("dialog-confirm-btn"),A=document.getElementById("dialog-cancel-btn"),Y=document.getElementById("dialog-icon-success"),X=document.getElementById("dialog-icon-error"),Z=document.getElementById("dialog-icon-info"),!ie||!Q||!z||!R||!Y||!X||!Z||!A){console.error("[Dialog] Un ou plusieurs √©l√©ments internes du dialog sont manquants. V√©rifie les IDs."),P=null;return}ie.addEventListener("click",be),R.addEventListener("click",Ht),A.addEventListener("click",zt),F.addEventListener("dialog:show",e=>{const t=e.detail||{},{title:n,message:o,variant:r}=t,a={variant:r,onConfirm:t.onConfirm,onCancel:t.onCancel,confirmText:t.confirmText,cancelText:t.cancelText,messageHtml:t.messageHtml};L(n,o,a)}),console.log("[Dialog] Module initialis√© et pr√™t (callbacks & HTML).")}}const jt=Object.freeze(Object.defineProperty({__proto__:null,initDialog:Rt,showDialog:L},Symbol.toStringTag,{value:"Module"}));function K(){const e=document.getElementById("search-modal"),t=document.getElementById("search-input");if(!e||!t)return;!e.classList.contains("hidden")?(e.classList.add("opacity-0"),setTimeout(()=>e.classList.add("hidden"),300)):(e.classList.remove("hidden"),requestAnimationFrame(()=>e.classList.remove("opacity-0")),t.focus())}function Ft(e){const t=document.getElementById("search-results");if(t){if(e.length===0){t.innerHTML='<p class="text-center p-4" style="color: var(--text-muted-color);">Aucun r√©sultat trouv√©. Veuillez consulter notre assistante Stacy pour plus de recommandations.</p>';return}t.innerHTML=e.map(n=>{const o=n.coverImage||"",r=typeof n.price.amount=="number"?n.price.amount:0,a=n.price.currency||"EUR";return`
    <a href="${n.url||"#"}" class="flex items-center p-3 hover:bg-gray-100/50 transition-colors zflex-link border-b" style="border-color: var(--card-border-color);">
      <img src="${o}" alt="${n.title}" class="w-12 h-12 object-cover rounded-md mr-4 flex-shrink-0">
      <div class="flex-grow">
        <h4 class="font-semibold" style="color: var(--text-color);">${n.title}</h4>
        <p class="text-sm font-bold" style="color: var(--primary-color);">${r.toFixed(2)} ${a}</p>
      </div>
    </a>
  `}).join("")}}async function Ut(){const e=document.getElementById("search-toggle-btn"),t=document.getElementById("search-modal"),n=document.getElementById("search-modal-overlay"),o=document.getElementById("search-input"),r=document.getElementById("search-results");if(!e||!t||!o||!n||!r)return;const a=await $e();e.addEventListener("click",K),n.addEventListener("click",K),o.addEventListener("input",()=>{const l=o.value.trim().toLowerCase();if(l.length<2){r.innerHTML='<p class="text-center p-4" style="color: var(--text-muted-color);">Tapez au moins 2 caract√®res pour rechercher.</p>';return}const d=a.filter(p=>p.title.toLowerCase().includes(l)).slice(0,5);Ft(d)}),document.addEventListener("keydown",l=>{l.key==="Escape"&&!t.classList.contains("hidden")&&K()}),r.addEventListener("click",l=>{l.target.closest("a")&&K()})}function Vt(){const e=document.getElementById("site-header");if(!e||e.dataset.variant!=="transparent")return;const t=()=>{window.scrollY>50?e.classList.add("scrolled"):e.classList.remove("scrolled")};window.addEventListener("scroll",t,{passive:!0}),t()}function Jt(){const e=document.getElementById("mobile-menu-button"),t=document.getElementById("mobile-menu");!e||!t||e.addEventListener("click",()=>{t.classList.toggle("hidden")})}function Wt(){const e=document.getElementById("settings-toggle-btn"),t=document.getElementById("settings-menu");!e||!t||(e.addEventListener("click",n=>{n.stopPropagation(),t.classList.toggle("hidden")}),document.addEventListener("click",()=>{t.classList.add("hidden")}))}function Kt(){Vt(),Jt(),Wt(),console.log("[GlobalUI] Module initialis√©.")}function Gt(){try{const e=document.getElementById("zflex-data");return e?JSON.parse(e.textContent||"{}"):{}}catch(e){return console.error("[Newsletter] getPageData parse error",e),{}}}function Qt(){const e=document.getElementById("newsletter-form"),n=Gt().storeId;if(!e){document.querySelector(".newsletter-section")&&console.warn("Newsletter form not found. Skipping initialization.");return}e.addEventListener("submit",async o=>{o.preventDefault();const r=e.querySelector('input[type="email"]');if(!r){console.error("Email input not found in newsletter form."),L("Erreur","Impossible de trouver le champ email.",{variant:"error"});return}const a=r.value.trim();if(!a){L("Attention","Veuillez entrer une adresse email valide.",{variant:"info"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)){L("Attention","Le format de l'adresse email est invalide.",{variant:"info"});return}const l=e.querySelector('button[type="submit"]');l&&(l.disabled=!0,l.textContent="Envoi..."),r.disabled=!0;try{const d=await et(a,n);if(d&&d.success)L("Merci !",`Vous √™tes maintenant inscrit avec l'adresse : ${a}`,{variant:"success"}),e.reset();else{const p=d?.message||"Une erreur est survenue lors de l'inscription. Veuillez r√©essayer.";L("Erreur",p,{variant:"error"})}}catch(d){console.error("Newsletter subscription error:",d),L("Erreur","Une erreur inattendue est survenue. Veuillez r√©essayer plus tard.",{variant:"error"})}finally{l&&(l.disabled=!1,l.textContent="S'abonner"),r.disabled=!1}})}function Yt(){console.log("[Preview] Initialisation du mode √©diteur temps r√©el");const e={"palette.primary":"--primary-color","palette.secondary":"--secondary-color","palette.background":"--bg-color","palette.text":"--text-color","palette.accent":"--accent-color","palette.cardBackground":"--card-bg-color","palette.textMuted":"--text-muted-color","palette.cardBorder":"--card-border-color","palette.inputBackground":"--input-bg-color","palette.chatResponseBackground":"--chat-response-bg-color",primary:"--primary-color",secondary:"--secondary-color",background:"--bg-color",text:"--text-color",accent:"--accent-color",cardBackground:"--card-bg-color","primary-color":"--primary-color","bg-color":"--bg-color","card-bg-color":"--card-bg-color"};function t(i){if(!i)return null;if(typeof i=="string"&&i.startsWith("--"))return i;const s=String(i).trim();if(e[s])return e[s];const f=s.replace(/^palette[\._-]?/i,"").replace(/\./g,"").replace(/_/g,"").toLowerCase(),c={primary:"--primary-color",primary600:"--primary-600",primary700:"--primary-700",secondary:"--secondary-color",secondary600:"--secondary-600",background:"--bg-color",text:"--text-color",accent:"--accent-color",cardbackground:"--card-bg-color",textmuted:"--text-muted-color",cardborder:"--card-border-color",inputbackground:"--input-bg-color",chatresponsebackground:"--chat-response-bg-color"};return c[f]?c[f]:`--${s.replace(/^palette[\._-]?/i,"").replace(/\./g,"-").replace(/_/g,"-").toLowerCase()}`}function n(i={}){if(!i||typeof i!="object")return;const s=document.documentElement;Object.keys(i).forEach(f=>{const c=i[f];if(typeof c!="string"&&typeof c!="number")return;const u=f.startsWith("--")?f:t(f)||`--${f}`;s.style.setProperty(u,String(c))}),window.requestAnimationFrame(()=>{document.body.offsetHeight})}function o(i){if(!i)return;const s=i.computed||{},f=i.palette||{},c={};Object.keys(f).forEach(u=>{const g=t(u)||t(`palette.${u}`)||`--${u}`;g&&(c[g]=f[u])}),Object.keys(s).forEach(u=>{const g=t(u)||`--${u.replace(/[A-Z]/g,w=>"-"+w.toLowerCase())}`;g&&(c[g]=s[u])}),n(c),console.log("[Preview] Applied computed palette vars:",c)}function r(i){if(i==null)return"";let s=String(i).trim();return/^[0-9A-Fa-f]{6}$/.test(s)&&(s="#"+s),s}function a(i){if(!i)return;let{property:s,value:f}=i;const c=t(s)||s,u=r(f);c&&(document.documentElement.style.setProperty(c,u),(c.includes("color")||c.includes("bg")||c.includes("background"))&&(document.body.style.transition="background-color 0.22s ease, color 0.22s ease, border-color 0.22s ease",setTimeout(()=>{document.body.style.transition=""},300)),console.log(`[Preview] Mise √† jour style (incoming: ${String(s)}) -> canonical: ${c}: ${u}`))}function l(i){if(!i)return;const{id:s,value:f}=i,c=document.querySelector(`[data-zflex-id="${s}"]`);if(!c){console.warn(`[Preview] √âl√©ment introuvable : ${s}`);return}const u=c.tagName.toUpperCase();if(u==="IMG")c.src=f,c.alt||(c.alt="Image");else if(u==="I"||c.classList.contains("fa")||c.classList.contains("fas")||c.classList.contains("fab")||s.includes(".icon")){let g=String(f).trim();if(!g)return;!g.startsWith("fa-")&&!g.includes(" ")&&(g=`fa-${g}`),!g.includes("fas")&&!g.includes("fab")&&!g.includes("far")&&!g.includes("fal")&&(g=`fas ${g}`);const w=Array.from(c.classList).filter(E=>!E.startsWith("fa-")&&E!=="fas"&&E!=="fab"&&E!=="far"&&E!=="fa");c.className=`${w.join(" ")} ${g}`}else if(s.toLowerCase().includes("image")||s.includes("bg"))if(c.style.backgroundImage.includes("linear-gradient")){const g=c.style.backgroundImage.split(", url");c.style.backgroundImage=`${g[0]}, url('${f}')`}else c.style.backgroundImage=`url('${f}')`;else/<[a-z][\s\S]*>/i.test(f)?c.innerHTML=f:c.textContent=f;u!=="I"&&d(c)}function d(i){i&&(i.style.transition="transform 0.2s ease, outline 0.2s ease",i.style.outline="2px solid rgba(0, 229, 255, 0.5)",i.style.transform="scale(1.02)",i.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),setTimeout(()=>{i.style.transform="",i.style.outline=""},400))}function p(i){const{id:s}=i;let f=document.querySelector(`[data-zflex-section="${s.toLowerCase()}"]`)||document.querySelector(`[data-zflex-id="${s}"]`)||document.getElementById(s);f?d(f):console.log(`[Preview] Highlight: Element ${s} not found.`)}window.addEventListener("message",i=>{if(!i?.data)return;const s=i.data;if(s.source==="zflex-admin")switch(console.log("[Preview] Message re√ßu de l'√©diteur:",s),s.action){case"updateElement":l(s.payload);break;case"updateStyle":a(s.payload);break;case"updatePalette":o(s.payload);break;case"updateRepeater":v(s.payload);break;case"updateVariant":y(s.payload);break;case"updateLayout":m(s.payload);break;case"highlight":p(s.payload);break;default:console.warn("[Preview] Action non reconnue:",s.action)}});function m(i){const{sections:s}=i,f=document.querySelector('main[data-page-type="home"]');f&&(console.log("[Preview] Reordering layout...",s),s.forEach(c=>{const u=f.querySelector(`[data-zflex-section="${c.type}"]`);u&&(f.appendChild(u),u.style.animation="none",u.offsetHeight,u.style.animation="fadeIn 0.5s")}))}function y(i){const{id:s,variant:f,data:c}=i,u=document.querySelector(`[data-zflex-variant-container="${s}"]`),g=document.querySelector(`template[data-zflex-variant="${s}.${f}"]`);if(!u||!g){console.warn(`[Preview] Impossible de changer le variant : ${s} -> ${f}`);return}console.log(`[Preview] Swap variant ${s} vers ${f}`);const E=g.content.cloneNode(!0).firstElementChild;E&&(h(E,c),u.style.opacity="0",setTimeout(()=>{u.innerHTML="",u.appendChild(E),u.style.opacity="1"},150))}function h(i,s){if(i.querySelectorAll("[data-zflex-bind]").forEach(c=>{const u=c.getAttribute("data-zflex-bind");if(!u)return;const g=s[u];if(g===void 0)return;const w=c;if(w.tagName==="IMG")w.src=String(g);else if(w.classList.contains("fa")||u==="icon"||w.tagName==="I"){const E=Array.from(w.classList).filter(O=>!O.startsWith("fa-")&&O!=="fas"&&O!=="fab"&&O!=="far"&&O!=="fa");let b=String(g).trim();if(!b)return;!b.startsWith("fa-")&&!b.includes(" ")&&(b=`fa-${b}`),!b.includes("fas")&&!b.includes("fab")&&!b.includes("far")&&(b=`fas ${b}`),w.className=`${E.join(" ")} ${b}`}else w.textContent=String(g)}),i.hasAttribute("data-zflex-bind")){const c=i.getAttribute("data-zflex-bind");c&&s[c]!==void 0&&(i.textContent=String(s[c]))}}function v(i){const{id:s,items:f}=i,c=document.querySelector(`[data-zflex-repeater="${s}"]`),u=document.querySelector(`template[data-zflex-template="${s}"]`);if(!c||!u){console.warn(`[Preview] Impossible de mettre √† jour le repeater : ${s}. Conteneur ou Template manquant.`);return}console.log(`[Preview] R√©g√©n√©ration du repeater ${s} avec ${f.length} √©l√©ments.`),c.innerHTML="",f.forEach((g,w)=>{const b=u.content.cloneNode(!0).firstElementChild;if(b){if(b.querySelectorAll("[data-zflex-bind]").forEach(V=>{const Ge=V.getAttribute("data-zflex-bind");V.setAttribute("data-zflex-id",`${s}[${w}].${Ge}`)}),b.hasAttribute("data-zflex-bind")){const V=b.getAttribute("data-zflex-bind");b.setAttribute("data-zflex-id",`${s}[${w}].${V}`)}h(b,g),c.appendChild(b)}}),c.style.transition="opacity 0.2s",c.style.opacity="0.5",setTimeout(()=>c.style.opacity="1",200)}window.parent!==window&&window.parent.postMessage({source:"zflex-preview",action:"ready",payload:{url:window.location.href}},"*")}const{initGlobalCart:Xt,initCartPage:Zt,initAddToCartButton:en}=st,{initStacy:tn}=Mt,{initDialog:nn}=jt,{initPwa:on}=Nt,{initAnalytics:rn}=vt;let Te=!1,N=null;const _e={"product-detail":async()=>{const{initProductGallery:e}=await B(async()=>{const{initProductGallery:t}=await import("./product-gallery-CW4kno63.js");return{initProductGallery:t}},[]);return en(),e(),{destroy:()=>console.log("[App] Cleanup: product-detail")}},"category-view":async()=>{const{initFilterSort:e}=await B(async()=>{const{initFilterSort:t}=await import("./filter-sort-N7D9O7i0.js");return{initFilterSort:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: category-view")}},cart:async()=>(Zt(),{destroy:()=>console.log("[App] Cleanup: cart")}),checkout:async()=>{const{initCheckout:e}=await B(async()=>{const{initCheckout:t}=await import("./checkout-HIkj-jfw.js");return{initCheckout:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: checkout")}},"order-success":async()=>{const{initOrderSuccess:e}=await B(async()=>{const{initOrderSuccess:t}=await import("./order-success-CkaqztLk.js");return{initOrderSuccess:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: order-success")}},verify:async()=>{const{initVerifyPage:e}=await B(async()=>{const{initVerifyPage:t}=await import("./verify-P5e-wCt9.js");return{initVerifyPage:t}},__vite__mapDeps([0,1]));return e(),{destroy:()=>console.log("[App] Cleanup: verify")}},"not-found":async()=>({destroy:()=>console.log("[App] Cleanup: not-found")}),unknown:async()=>({destroy:()=>{}})};async function ke(){N&&typeof N.destroy=="function"&&N.destroy();const t=document.querySelector("#app-content main")?.dataset?.pageType||"unknown";console.log(`[App] Chargement des scripts pour la page: "${t}"`);const n=_e[t]||_e.unknown;try{N=await n()}catch(o){console.error(`[App] Erreur lors du chargement du module pour "${t}":`,o),N=null}Qt()}function Ae(){if(Te)return;console.log("[App] D√©marrage zFlex ‚Äî L'Architecture Finale.");const e=new URLSearchParams(window.location.search).get("preview")==="true";e?(console.log("[App] Mode Preview activ√© - D√©sactivation des interactions utilisateur"),document.body.style.pointerEvents="none",document.body.style.cursor="not-allowed",Yt()):console.log("[App] Mode normal - Initialisation des scripts interactifs");try{if(!window.firebase||!window.firebase.initializeApp)throw new Error("Le SDK Firebase (compat) n'a pas √©t√© charg√©. V√©rifie les scripts dans _head.njk.");const n=document.getElementById("firebase-config-data");if(!n)throw new Error("Firebase config data island not found.");const o=JSON.parse(n.textContent||"{}");if(!o.apiKey)throw new Error("Firebase apiKey is missing.");window.firebase.initializeApp(o),console.log("[Firebase] Initialisation via le scope global r√©ussie.")}catch(n){console.error("[Firebase] √âCHEC CRITIQUE DE L'INITIALISATION :",n);return}e||(Xt(),tn(wt),Kt(),Ut(),nn(),on(),rn(),ze(),window.addEventListener("zflex:page-loaded",(n=>{console.log(`[App] Page charg√©e via Router: ${n.detail?.path}`),ke()}))),ke(),Te=!0;const t=["color: #00BFFF","font-size: 12px","font-family: monospace","background: #0E0E0E","padding: 4px 8px","border-radius: 4px"].join(";");console.log("%c Fearless Engine: Online. Status: Flawless. ",t),window.location.hostname==="localhost"||window.location.hostname.includes("192.168.")?(console.log("------------------"),console.log("< Happy Hacking! ‚Äî Fearless >"),console.log("------------------"),console.log("        \\   ^__^"),console.log("         \\  (oo)\\_______"),console.log("            (__)\\       )/\\"),console.log("                ||----w |"),console.log("                ||     ||"),console.log(`
version: dev (local)`)):(console.log("------------------"),console.log("< Ready for Action! ‚Äî Fearless >"),console.log("------------------"),console.log("        \\   ^__^"),console.log("         \\  (oo)\\_______"),console.log("            (__)\\       )/\\"),console.log("                ||----w |"),console.log("                ||     ||"),console.log(`
version: production (${new Date().toISOString().slice(0,10)})`))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ae,{once:!0}):Ae();export{B as _,dn as a,ln as b,an as c,nt as d,F as e,$e as f,$ as g,sn as h,cn as i,je as n,L as s};
